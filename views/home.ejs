<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Shop</title>
	<link rel="stylesheet" type="text/css" href="/css/Style.css">
	<link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
</head>
<body>
	<a id="topBtn">
		<i class="fas fa-arrow-circle-up"></i>
	</a>
	<div class="header" id="top">
		<nav class="nav">
			<div class="logo">
				<h4>BOOK STORE</h4>
			</div>
			<form action="/auth/logout" method="POST" id="frmSignout"></form>
			<ul class="nav-links">
				<li><a href="">HOME </a></li>
				<li><a href="">ABOUT <i class="fas fa-chevron-down"></i></a>
					<ul class="child-links">
						<li><a href="">ME</a></li>
						<li><a href="">HISTORY</a></li>
					</ul>
				</li>
				<% if(isAuthenticated != true){ %>
					<li><a href="">USER <i class="fas fa-chevron-down"></i></a>
						<ul class="child-links">
							<li><a href="/auth/login">Login</a></li>
							<li><a href="/auth/register">Register</a></li>
						</ul>
					</li>
				<% } %>
				<% if(isAuthenticated == true){ %>
					<li><a href="">Hi,Tien<i class="fas fa-chevron-down"></i></a>
						<ul class="child-links">
							<li><a href="javascript: $('#frmSignout').submit();">Logout</a></li>
							<li><a href="/auth/profile">Profile</a></li>
							<li><a href="/auth/payment">Payment</a></li>
						</ul>
					</li>
				<% } %>
				<li><a href="/product/cart"><i class="fas fa-cart-plus"></i> <span><%=numberOfProInCart %></span></a></li>
			</ul>
			<div class="burger">
				<div class="line1"></div>
				<div class="line2"></div>
				<div class="line3"></div>
			</div>
		</nav>
	</div>
	
	<div class="card-body" >
		<div class=" top-index">
		<h1 class="text-center" >TOP BEST-SELLING PRODUCTS</h1>
		<div class="col-12">
			<div id="carouselExampleControls" class="carousel slide top-selling" style="width: 70%;"  data-ride="carousel">
				<div class="carousel-inner">
					<div class="carousel-item active carousel-image">
						<div class="overlay-carousel">
							<a href="/product/detail/<%=topSellPros[0].ProId %> & <%= topSellPros[0].ProCat%>">
								<img src="<%= topSellPros[0].ProImg %>" class=" scale-image" alt="...">
							</a>
						</div>
					</div>
					<% for(var i = 1; i < topSellPros.length; i++) { %>
						<div class="carousel-item carousel-image">
							<a href="/product/detail/<%=topSellPros[i].ProId %> & <%= topSellPros[i].ProCat%>">
								<img src="<%= topSellPros[i].ProImg %>" class=" scale-image" alt="...">
							</a>
						</div>
					<% } %>
				</div>
				<a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="sr-only">Previous</span>
				</a>
				<a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a>
			</div>
		</div>			
	</div>
	<div class="container menu-product ">
		<h1 class="text-center">ALL PRODUCTS</h1>
			<div class="search-bar">
				<input type="text" name="nameSearch" id="txtSearch" placeholder="Nhập nội dung muốn tìm kiểm....">
			</div>
			<div class="row list-product" id="allProduct">
				<% for(var i=0; i < allProduct.length; i++) { %>
				<div class="Component">
					<a class="Image" href="/product/detail/<%= allProduct[i].ProId %> & <%= allProduct[i].ProCat%>" style="background-image: url('<%= allProduct[i].ProImg %>')"></a>
					<a class="Name-Product" href="/product/detail/<%= allProduct[i].ProId %> & <%= allProduct[i].ProCat%>"><%= allProduct[i].ProName %></a> 
					<label class="Price-Product"><%= allProduct[i].ProCurrentPrice %> VND</label>
					<a href="/product/cart/add/<%= allProduct[i].ProId %>" class="AddToCart">
						<i class="fas fa-cart-plus"></i>
					</a>
				</div>
				<% } %>
				
			</div>
			<div class="row col-12 load-more text-center">
				<button class="load-more-btn" id="btnLoadmore">LOAD MORE</button>
			</div>
		</div>
	</div>
	<div class="container">
		<h1 class="text-center" style="margin: 5% 0%; border-bottom: 2px solid #F9B500; padding-bottom: 1%;font-weight: bold;">MỘT SỐ THỂ LOẠI PHỔ BIẾN</h1>
		<div class="row">
			<% for(var i = 0; i < popCats.length; i++) { %>
				<div class="cate-component" style="background-image: url('<%= popCats[i].img %>')">
					<a href="/product/archive/<%= popCats[i].CatId %>">
						<div class="overlay">
							<h1><%= popCats[i].CatName %></h1>
							<h3>(<%= popCats[i].count %>)</h3>
						</div>
					</a>
				</div>
			<% } %>
		</div>
		
	</div>
	<div class="container " style="margin-top: 5rem;">
		<div class="row">
			<div class="col-8">
				<h1 class="text-center title-footer">RECENT PRODUCTS</h1>
				<div class="row list-product">
					<% for(var i=0; i < newProducts.length; i++) { %>
						<div class="Component">
							<a class="Image" href="/product/detail/<%= newProducts[i].ProId %> & <%= newProducts[i].ProCat%>" style="background-image: url('<%= newProducts[i].ProImg %>')"></a>
							<a class="Name-Product" href="/product/detail/<%= newProducts[i].ProId %> & <%= newProducts[i].ProCat%>"><%= newProducts[i].ProName %></a> 
							<label class="Price-Product"><%= newProducts[i].ProCurrentPrice %> VND</label>
							
							<a href="/product/cart/add/<%= newProducts[i].ProId %>" class="AddToCart">
								<i class="fas fa-cart-plus"></i>
							</a>
						</div>
					<% } %>
				</div>
			</div>
			<div class="col-4">
				<h1 class="title-footer text-center">TOP CATEGORIES</h1>
				<ul class="list-group list-footer">
					<% for(var i = 0; i< topCats.length; i++) { %>
						<li class="list-group-item d-flex justify-content-between align-items-center ">
							<a href="/product/archive/<%= topCats[i].CatId %>" class="Name-Product-1 text-left"><%= topCats[i].CatName %></a>
							<span class="badge badge-primary badge-pill"><%= topCats[i].count %></span>
						</li>
					<% } %>
				</ul>
			</div>
		</div>
	</div>

	<footer>
		<div class=" footer" style="margin-top: 5rem;">
			<div class="row">
				<div class="col-4">
					<h4 class="text-white text-center title-footer">Dịch vụ</h4>
					<ul class="list-group list-group-flush list-footer">
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Điều khoản sử dụng</a>
						</li>
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Chính sách bảo mật</a>
						</li>
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Giới thiệu</a>
						</li>
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Hệ thống trung tâm cửa hàng</a>
						</li>
					</ul>
				</div>
				<div class="col-4">
					<h4 class="text-white text-center title-footer" >Hỗ trợ</h4>
					<ul class="list-group list-group-flush list-footer">
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Chính sách khuyến mãi</a>
						</li>
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Phương thức thanh toán</a>
						</li>
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Phương thức vận chuyển</a>
						</li>
						<li class="list-group-item">
							<a href="" class="Name-Product-1">Chính sách đổi trả</a>
						</li>
					</ul>
				</div>
				<div class="col-4">
					<h4 class="text-white text-center title-footer">Liên hệ</h4>
					<ul class="list-group list-group-flush list-footer">
						<li class="list-group-item">
							<i class="fas fa-map-marker-alt"></i>
							<p>Địa chỉ: 595 CMT8 Phường 12 Quận 5 TPHCM</p>
						</li>
						<li class="list-group-item">
							<i class="far fa-envelope"></i>
							<p>1612694@student.hcmus.edu.vn</p>
						</li>
						<li class="list-group-item">
							<i class="fas fa-phone"></i>
							<p>0123456789</p>
						</li>
					</ul>
				</div>
				<div class="col-6">
					<div class="quote-primary">
						<img src="/images/logo.jpg" class="logo-footer" alt="">
					</div>
				</div>
				<div class="col-6">
					<h4 class="text-white text-center title-footer">Follow us</h4>
					<div class="text-center">
						<a href="" class="icon-footer">
							<i class="fab fa-facebook"></i>
						</a>
						<a href="" class="icon-footer">
							<i class="fab fa-instagram"></i>
						</a>
						<a href="" class="icon-footer">
							<i class="fab fa-twitter"></i>
						</a>
						<a href="" class="icon-footer">
							<i class="fab fa-google-plus-g"></i>
						</a>
					</div>
					<p class="text-white">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Voluptatum enim iusto laudantium sed officiis pariatur facilis repellendus doloribus omnis consequuntur cupiditate quas minus doloremque nihil perferendis libero qui, quae magni.</p>
					<p class="text-white">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Voluptatum enim iusto laudantium sed officiis pariatur facilis repellendus doloribus omnis consequuntur cupiditate quas minus doloremque nihil perferendis libero qui, quae magni.</p>
					<p class="text-white">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Voluptatum enim iusto laudantium sed officiis pariatur facilis repellendus doloribus omnis consequuntur cupiditate quas minus doloremque nihil perferendis libero qui, quae magni.</p>
					<p class="text-white">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Voluptatum enim iusto laudantium sed officiis pariatur facilis repellendus doloribus omnis consequuntur cupiditate quas minus doloremque nihil perferendis libero qui, quae magni.</p>
					<p class="text-white">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Voluptatum enim iusto laudantium sed officiis pariatur facilis repellendus doloribus omnis consequuntur cupiditate quas minus doloremque nihil perferendis libero qui, quae magni.</p>
				</div>
			</div>
		</div>
	</footer>	
	
	<script>
		let soTrang = 1;
		let tempCur = "<%=allProduct.length%>";
		let current = parseInt(tempCur);
		
		$(document).ready(function(){

			$(window).scroll(function(){
				if($(this).scrollTop() > 40) 
				{
					$("#topBtn").fadeIn();
				}else
				{
					$("#topBtn").fadeOut();
				}
			});

			$("#topBtn").click(function(){
				$("html,body").animate({scrollTop: 0},800);
			});

			$(document).on("click","#btnLoadmore",function(){

				soTrang += 1;
				
				$.ajax({
					async: false,
					type: 'GET',
					url: "../page/"+soTrang,
					success: function(res){
						$('#allProduct').append(res);
						
					},
					error: function(xhr,ajaxOption,thrownError){
						alert("Fail");
					}
				})

				current += 5;
				console.log(current);
				if(current >= '<%=max%>')
				{
					$('#btnLoadmore').css("visibility","hidden")
				}
			})

			$(document).on("keyup","#txtSearch", function(){
				var data = $(this).val();
				current = 5;
				soTrang = 1;
				$('#btnLoadmore').css("visibility","visible");
				$.ajax({
					async: false,
					type: "POST",
					url: "../search",
					contentType: "application/x-www-form-urlencoded",
					dataType: "html",
					data: {data:data},
					success: function(res){
						$('#allProduct').replaceWith(res);
					
					},
					error: function(xhr,ajaxOption,thrownError){
						alert("Failed");
					}
				})
			})
			
		})
	</script>
	<script src="/js/nav.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>